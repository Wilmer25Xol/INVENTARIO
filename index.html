<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inventario Madera — Compartido (Realtime)</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--muted:#93a3b8;--text:#e5e7eb;--accent:#22c55e;--danger:#ef4444;--blue:#3b82f6}
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,var(--bg),#020617 70%);color:var(--text);font-family:system-ui,Segoe UI,Roboto}
    .wrap{max-width:1100px;margin:20px auto;padding:14px}
    h1{margin:0 0 8px}
    .card{background:var(--card); padding:14px; border-radius:12px; border:1px solid rgba(255,255,255,0.03)}
    form .row{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    label{font-size:12px;color:var(--muted)}
    input,select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#07101a;color:var(--text)}
    button{padding:8px 12px;border-radius:999px;border:0;background:var(--accent);color:#052e16;font-weight:700;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:10px} th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
    .danger{background:var(--danger);color:white}
    .small{font-size:13px;color:var(--muted)}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  </style>

  <!-- SheetJS para export a Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <!-- Firebase compat (fácil de integrar) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <div class="wrap">
    <header style="display:flex;justify-content:space-between;align-items:end;gap:12px;margin-bottom:12px">
      <div>
        <h1>Inventario de Madera — Compartido</h1>
        <div class="small">Los movimientos se sincronizan en <b>tiempo real</b> entre todos los usuarios.</div>
      </div>
      <div class="toolbar card" style="padding:8px">
        <button id="btn-download">Descargar Excel (.xlsx)</button>
        <button id="btn-clear-local" class="danger">Vaciar local</button>
      </div>
    </header>

    <section class="card">
      <form id="form">
        <div class="row">
          <div>
            <label>Fecha</label><input id="fecha" type="date" />
          </div>
          <div>
            <label>Tipo</label>
            <select id="tipo"><option>Ingreso</option><option>Salida</option></select>
          </div>
          <div>
            <label>Lote</label><input id="lote" placeholder="L-2025-09-01" />
          </div>

          <div>
            <label>Especie</label>
            <select id="especie">
              <option>Palo Blanco</option><option>Pino</option><option>Caoba</option><option>Encino</option>
              <option>Liquidambar</option><option>Teca</option><option>Cipres</option><option>Eucaliptos</option><option>Otros</option>
            </select>
          </div>

          <div>
            <label>Ubicación</label>
            <select id="ubicacion">
              <option>Patio Oficina</option><option>Patio Ceiba</option><option>Patio Secadora</option>
              <option>Adentro de Carpintería</option><option>Galera</option><option>Otro</option>
            </select>
          </div>

          <div>
            <label>Largo (cm)</label><input id="largo" type="number" step="0.01" />
          </div>
          <div>
            <label>Ancho (cm)</label><input id="ancho" type="number" step="0.01" />
          </div>
          <div>
            <label>Espesor (cm)</label><input id="espesor" type="number" step="0.01" />
          </div>
          <div>
            <label>Cantidad (piezas)</label><input id="cantidad" type="number" step="1" min="1" />
          </div>
          <div>
            <label>Precio (Q) opcional</label><input id="precio" type="number" step="0.01" />
          </div>
          <div style="grid-column:span 6">
            <label>Observaciones</label><input id="obs" />
          </div>

          <div style="grid-column:span 6;display:flex;gap:8px;margin-top:8px">
            <button type="button" id="btn-add">Agregar movimiento (guardar en nube)</button>
            <button type="button" id="btn-add-local" style="background:#7f8c8d">Agregar solo local</button>
            <div class="small" style="align-self:center">Si quieres que otros vean, usa <b>Agregar movimiento</b>.</div>
          </div>
        </div>
      </form>
    </section>

    <section class="card" style="margin-top:12px">
      <h3 style="margin:6px 0">Movimientos (en la nube)</h3>
      <div class="small">Los movimientos visibles son los que existen en la base compartida.</div>
      <div style="overflow:auto;margin-top:8px">
        <table id="tbl-mov">
          <thead>
